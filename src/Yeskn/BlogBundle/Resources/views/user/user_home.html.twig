{% extends '@YesknBlog/base.html.twig' %}

{% block main %}
    <div class="row">
        <div class="col-lg-12">
            <div class="panel-body" style="background: #fff;margin-bottom: 10px">
                <ul class="chat">
                    <li class="left clearfix user-meta">
                        <span class="chat-img pull-left">
                              <img src="{{ user.avatar }}" alt="User Avatar" class="img-circle" width="50" height="50">
                        </span>
                        <div class="chat-body clearfix">
                            <div class="header">
                                <strong class="primary-font"><a href="{{ path('user_home', {username: user.username}) }}" data-pjax>{{ user.nickname }}</a></strong>
                                <small class="pull-right text-muted">
                                    <i class="fa fa-clock-o fa-fw"></i> åŠ å…¥äº{{ user.registerAt|date('Y-m-d H:i:s') }}, ç¬¬{{ user.id }}ä½Vmoexç”¨æˆ·
                                </small>
                            </div>
                            <p>{{ user.remark|raw }}</p>
                            <br/>
                            {% if app.user != user %}
                                <button type="button" data-toggle="modal" data-target="#exampleModal" class="btn btn-warning btn-sm"><i class="fa fa-envelope"></i> å‘é€ç§ä¿¡</button>
                                <button type="button" id="follow-user" class="btn btn-outline btn-danger btn-sm"><i class="fa fa-heart"></i> {% if app.user in user.followers %}å·²ç»å…³æ³¨{% else %}ç‰¹åˆ«å…³æ³¨{% endif %}</button>
                                <button type="button" id="block-user" class="btn btn-outline btn-warning btn-sm"><i class="fa fa-lock"></i> å±è”½æ­¤äºº</button>
                            {% endif %}
                          </div>
                    </li>
                </ul>
            </div>

            <div class="panel panel-default">
                <div class="panel-heading">
                    {{ user.nickname }}å‘å¸ƒçš„æ–‡ç« 
                </div>
                <div class="panel-body">
                    æœ€è¿‘æ²¡æœ‰å‘å¸ƒä»»ä½•æ–‡ç« ã€‚
                </div>
            </div>
            <div class="panel panel-default">
                <div class="panel-heading">
                    {{ user.nickname }}çš„å›å¤
                </div>
                <div class="panel-body">
                    æœ€è¿‘æ²¡æœ‰å‘å¸ƒä»»ä½•å›å¤ã€‚
                </div>
            </div>

            <div class="panel panel-default">
                <div class="panel-heading">
                    {{ user.nickname }}çš„å…³æ³¨
                </div>
                <div class="panel-body">
                    {% if user.following is not empty %}
                        {% for fo in user.following %}
                            <li style="list-style: none;margin: 10px 0;display: inline-block;padding-right: 10px">
                                <a data-pjax href="{{ path('user_home', {username: fo.username}) }}">
                                    <img src="{{ fo.avatar }}" alt="" width="25" height="25" style="border-radius: 50%">
                                    {{ fo.nickname }}
                                </a>
                            </li>
                        {% endfor %}
                        {% else %}
                            {{ user.nickname }}æ¯”è¾ƒé«˜å†·ğŸ˜Œï¼Œç›®å‰æ²¡æœ‰å…³æ³¨ä»»ä½•äººã€‚
                    {% endif %}
                </div>
            </div>

            <div class="panel panel-default">
                <div class="panel-heading">
                    {{ user.nickname }}çš„ç²‰ä¸
                </div>
                <div class="panel-body">
                    åå£°ä¸ä½³ï¼Œæ²¡æœ‰ä»»ä½•ç²‰ä¸â•®(â•¯_â•°)â•­
                </div>
            </div>
        </div>
    </div>

    <script>
        $(function () {
            $(document).off('click', '#follow-user');
            $(document).on('click', '#follow-user', function () {
                $.ajax({
                    method: 'POST',
                    url: '{{ path("follow_user") }}',
                    data: {username: '{{ user.username }}'},
                    success: function (data) {
                        if (!data.ret) {
                            bootoast({
                                message: data.msg,
                                type: 'warning',
                                position: 'top-center',
                                icon: undefined,
                                timeout: 3,
                                animationDuration: 300,
                                dismissable: true
                            });
                        } else {
                            $.pjax.reload('.content-body', {
                                fragment: '.content-body',                          //æ¥æºä¹Ÿçš„ID
                                timeout: 200000000,
                                show: 'fade',
                                cache: true,  //æ˜¯å¦ä½¿ç”¨ç¼“å­˜
                                push: true,
                                replace: true
                                //scrollTo: 250,
                            })
                        }
                    }
                })
            });

            $(document).off('click', '#send-message');
            $(document).on('click', '#send-message', function() {
                var $this = $(this);
                $this.button('loading');

                $.ajax({
                    method: 'POST',
                    url: '{{ path("send_message") }}',
                    data: {content: $('#message-text').val(), to: '{{ user.username }}'},
                    success: function () {
                        alert('å‘é€æˆåŠŸ');
                        $this.button('reset');
                        $('#message-text').val('');
                        $('#exampleModal').modal('hide');
                    }
                });
            });
        })
    </script>


{% endblock %}